<!DOCTYPE html>
<html style="font-size: 16px;" lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta name="keywords" content="Welcome, {name}, Your healthscore:, {hs}, Your BMI:, {bmi}">
  <meta name="description" content="">
  <title>Home</title>
  <link rel="stylesheet" href="./static/nicepage.css" media="screen">
  <link rel="stylesheet" href="./static/css/Home.css" media="screen">
  <script class="u-script" type="text/javascript" src="./static/jquery-1.9.1.min.js" defer=""></script>
  <script class="u-script" type="module" src="./static/js/home.js" defer=""></script>
  <script class="u-script" type="text/javascript" src="./static/nicepage.js" defer=""></script>
  <meta name="generator" content="Nicepage 6.7.8, nicepage.com">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link id="u-theme-google-font" rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
  <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alata:400">




  <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "WebSite6229931",
		"url": "/",
		"logo": "images/logo-no-background.svg"
}</script>

  <meta name="theme-color" content="#478ac9">
  <meta property="og:title" content="Home">
  <meta property="og:description" content="">
  <meta property="og:type" content="website">
  <link rel="canonical" href="/">
  <meta data-intl-tel-input-cdn-path="intlTelInput/">
</head>

<body data-path-to-root="./" data-include-products="false" class="u-body u-stick-footer u-xl-mode" data-lang="en">
  <header class="u-clearfix u-grey-5 u-header u-header" id="sec-f5f7">
    <div class="u-clearfix u-sheet u-sheet-1">
      <a href="/dashboard" class="u-image u-logo u-image-1" data-image-width="1500" data-image-height="306">
        <img src="images/logo-no-background.svg" class="u-logo-image u-logo-image-1">
      </a>
      <nav class="u-menu u-menu-one-level u-offcanvas u-menu-1">
        <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
          <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base"
            href="#" style="padding: 3px 10px; font-size: calc(1em + 6px);">
            <svg class="u-svg-link" viewBox="0 0 24 24">
              <use xlink:href="#menu-hamburger"></use>
            </svg>
            <svg class="u-svg-content" version="1.1" id="menu-hamburger" viewBox="0 0 16 16" x="0px" y="0px"
              xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
              <g>
                <rect y="1" width="16" height="2"></rect>
                <rect y="7" width="16" height="2"></rect>
                <rect y="13" width="16" height="2"></rect>
              </g>
            </svg>
          </a>
        </div>
        <div class="u-custom-menu u-nav-container">
          <ul class="u-nav u-unstyled u-nav-1">
            <li class="u-nav-item"><a
                class="u-button-style u-nav-link u-text-active-custom-color-1 u-text-hover-custom-color-1"
                href="/dashboard" style="padding: 10px 20px;">Home</a>
            </li>
            <li class="u-nav-item"><a
                class="u-button-style u-nav-link u-text-active-custom-color-1 u-text-hover-custom-color-1"
                style="padding: 10px 20px;" href="/contact">Contact</a>
            </li>
            <li class="u-nav-item"><button style="padding: 10px 20px;" id="logoutButton">Logout</button>
            </li>
          </ul>
        </div>
        <div class="u-custom-menu u-nav-container-collapse">
          <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
            <div class="u-inner-container-layout u-sidenav-overflow">
              <div class="u-menu-close"></div>
              <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2">
                <li class="u-nav-item"><a class="u-button-style u-nav-link" href="/dashboard">Home</a>
                </li>
                <li class="u-nav-item"><a class="u-button-style u-nav-link" href="/contact">Contact</a>
                </li>
                <li class="u-nav-item"><button id="logoutButton2" style="color: black;">Logout</button>
                </li>
              </ul>
            </div>
          </div>
          <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
        </div>
      </nav>
    </div>
  </header>
  <section class="u-clearfix u-section-1" id="sec-0939">
    <div
      class="u-clearfix u-sheet u-valign-middle-lg u-valign-middle-md u-valign-middle-sm u-valign-middle-xs u-sheet-1">
      <div class="data-layout-selected u-clearfix u-expanded-width u-layout-wrap u-layout-wrap-1">
        <div class="u-layout">
          <div class="u-layout-row">
            <div class="u-container-style u-layout-cell u-size-30 u-layout-cell-1">
              <div class="u-container-layout u-container-layout-1">
                <h2 class="u-custom-font u-text u-text-1" data-animation-name="customAnimationIn"
                  data-animation-duration="1000" data-animation-delay="0">Welcome</h2>
                <h2 class="u-custom-font u-text u-text-custom-color-1 u-text-2" data-animation-name="customAnimationIn"
                  data-animation-duration="1000" data-animation-delay="0" id="name">{name}</h2>
                <h2 class="u-custom-font u-text u-text-3" data-animation-name="customAnimationIn"
                  data-animation-duration="1000" data-animation-delay="0">Your healthscore:</h2>
                <h2 class="u-custom-font u-text u-text-custom-color-1 u-text-4" data-animation-name="customAnimationIn"
                  data-animation-duration="1000" data-animation-delay="0" id="hs">{hs}</h2>
                <h2 class="u-custom-font u-text u-text-5" data-animation-name="customAnimationIn"
                  data-animation-duration="1000" data-animation-delay="0">Your BMI:</h2>
                <h2 class="u-custom-font u-text u-text-custom-color-1 u-text-6" data-animation-name="customAnimationIn"
                  data-animation-duration="1000" data-animation-delay="0" id="bmi">{bmi}</h2>
                <p class="u-custom-font u-text u-text-7" data-animation-name="customAnimationIn"
                  data-animation-duration="1000" data-animation-delay="0">Your Diet Plan suggested by us:</p>
                <div class="custom-expanded u-container-style u-custom-color-2 u-group u-radius u-shape-round u-group-1"
                  data-animation-name="customAnimationIn" data-animation-duration="1000" data-animation-delay="0">
                  <div
                    class="u-container-layout u-valign-top-lg u-valign-top-md u-valign-top-sm u-valign-top-xs u-container-layout-2">
                    <p class="u-custom-font u-text u-text-8" id="diet_plan">{diet plan }</p>
                    <button id="gendietplan" class="generate-button" onclick="generateDietPlan()">Generate Diet plan</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="u-container-style u-layout-cell u-size-30 u-layout-cell-2">
              <div class="u-container-layout u-valign-bottom-xl u-container-layout-3">
                <img
                  class="u-border-3 u-border-custom-color-1 u-expanded-width-xs u-hover-feature u-image u-image-round u-radius u-image-1"
                  src="images/2241577.jpg" alt="" data-image-width="2000" data-image-height="1865"
                  data-animation-out="1" data-animation-name="customAnimationIn" data-animation-duration="1000"
                  data-animation-delay="0">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </section>
  <section class="u-clearfix u-section-2" id="sec-90e1">
    <div class="u-clearfix u-sheet u-sheet-1">
      <blockquote
        class="u-border-custom-color-1 u-custom-font u-text u-text-default-lg u-text-default-md u-text-default-sm u-text-default-xs u-text-1">
        Calories don't lie. Track them, and take control of your health.</blockquote>
      <a href="/track"
        class="u-active-custom-color-1 u-border-2 u-border-custom-color-3 u-btn u-btn-round u-button-style u-gradient u-hover-custom-color-2 u-hover-feature u-none u-radius u-text-hover-black u-btn-1">
        Track your calories&nbsp;<span class="u-icon u-text-custom-color-3 u-icon-1"><svg class="u-svg-content"
            viewBox="0 0 490.667 490.667" x="0px" y="0px" style="width: 1em; height: 1em;">
            <path
              d="M466.201,237.781L231.534,3.115C229.55,1.131,226.841,0,224.003,0h-192c-4.309,0-8.213,2.603-9.856,6.592 s-0.725,8.555,2.304,11.627l227.136,227.115L24.451,472.448c-3.051,3.051-3.968,7.637-2.304,11.627 c1.664,3.989,5.547,6.592,9.856,6.592h192c2.837,0,5.547-1.131,7.552-3.115l234.667-234.667 C470.382,248.704,470.382,241.963,466.201,237.781z">
            </path>
          </svg></span>
      </a>
      <h5 class="u-custom-font u-text u-text-default-lg u-text-default-md u-text-default-sm u-text-default-xs u-text-2">
        Your weight transformation:</h5>
      <div class="u-container-style u-expanded-width u-grey-5 u-group u-radius u-shape-round u-group-1">
        <div class="u-container-layout u-container-layout-1">
          <canvas id="weightChart"></canvas>
        </div>
      </div>

      <h5 class="u-custom-font u-text u-text-default-lg u-text-default-md u-text-default-sm u-text-default-xs u-text-2">
        Your Daily Calorie intake:</h5>
      <div class="u-container-style u-expanded-width u-grey-5 u-group u-radius u-shape-round u-group-1">
        <div class="u-container-layout u-container-layout-1">
          <canvas id="calorieChart"></canvas>
        </div>
      </div>
    </div>

  </section>



  <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-06be">
    <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
      <p class="u-small-text u-text u-text-variant u-text-1"> © 2024 Blissful Bites</p>
    </div>
  </footer>



  <script>
    // Immediately check session and load data
    document.addEventListener('DOMContentLoaded', () => {
      console.log("[Init] Starting immediate dashboard initialization");
      const userEmail = sessionStorage.getItem('userEmail');
      
      if (!userEmail) {
        console.log("[Auth] No session found, redirecting to login");
        window.location.href = "/login";
        return;
      }

      // Fetch user data immediately
      fetch(`/userDetails?email=${userEmail}`)
        .then(response => {
          if (!response.ok) throw new Error('Network response was not ok');
          return response.json();
        })
        .then(data => {
          console.log("[Init] Received initial data:", data);
          
          // Calculate BMI
          const heightInM = data.height / 100;
          const bmi = (data.weight / (heightInM * heightInM)).toFixed(2);
          
          // Update UI immediately
          document.getElementById('name').textContent = data.name || 'User';
          document.getElementById('hs').textContent = data.healthscore || '0';
          document.getElementById('bmi').textContent = bmi || '0';
          document.getElementById('diet_plan').textContent = data.diet_plan || 'Click Generate Diet Plan to get your personalized diet plan';
          
          console.log("[Init] Dashboard updated with initial data");
        })
        .catch(error => {
          console.error('[Error] Initial data load failed:', error);
        });
    });

    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('trackUpdate');

    if (status === 'success') {
      alert("Your calories has been recorded!");
    } else if (status === 'error') {
      alert("An error occurred. Please try again.");
    }
  </script>
  <script>
    // Function to create weight chart
    function createWeightChart(weightMap, id, l) {
      // Get canvas element
      var ctx = document.getElementById(id).getContext('2d');

      // Extract dates and weights from weightMap
      var dates = Object.keys(weightMap);
      var weights = Object.values(weightMap).map(function (value) {
        // If the value is an array, return the first element, otherwise return the value itself
        return Array.isArray(value) ? value[0] : value;
      });

      // Chart configuration
      var config = {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: l,
            data: weights,
            borderColor: 'green',
            borderWidth: 1,
            fill: false
          }]
        },
        options: {
          responsive: true,
          title: {
            display: true,
            text: l+' over Dates'
          },
          scales: {
            xAxes: [{
              type: 'time',
              time: {
                unit: 'day'
              },
              scaleLabel: {
                display: true,
                labelString: 'Date'
              }
            }],
            yAxes: [{
              scaleLabel: {
                display: true,
                labelString: l
              }
            }]
          }
        }
      };

      // Create the chart
      var chart = new Chart(ctx, config);
    }

    // Function to generate diet plan
    async function generateDietPlan() {
      console.log("Generate Diet Plan button clicked");
      const dietPlanElement = document.getElementById('diet_plan');
      
      try {
        // Disable button and show loading state
        document.getElementById('gendietplan').disabled = true;
        console.log("Button disabled");
        
        if (dietPlanElement) {
          dietPlanElement.textContent = 'Generating your personalized diet plan...';
          console.log("Updated to loading state");
        }

        // Get email from session storage
        const userEmail = sessionStorage.getItem('userEmail');
        if (!userEmail) {
          throw new Error('No user email found in session');
        }

        // Fetch fresh user data
        console.log("Fetching fresh user data for email:", userEmail);
        const response = await fetch(`/userDetails?email=${userEmail}`);
        if (!response.ok) {
          throw new Error(`Failed to fetch user data: ${response.status}`);
        }
        const userData = await response.json();
        console.log("Fresh user data received:", userData);

        // Prepare data for diet plan generation
        const dietPlanData = {
          email: userEmail,
          name: userData.name,
          age: userData.age,
          gender: userData.gender,
          activityLevel: userData.activity_level,
          goals: userData.goals,
          height: userData.height,
          weight: userData.weight,
          tweight: userData.target_weight,
          disease: userData.diseases,
          healthscore: userData.healthscore,
          track: userData.track
        };
        console.log("Prepared diet plan request data:", dietPlanData);

        // Call diet plan generation API
        console.log("Calling diet plan generation endpoint");
        const dietResponse = await fetch('/genDietPlan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(dietPlanData)
        });

        if (!dietResponse.ok) {
          const errorData = await dietResponse.json();
          throw new Error(errorData.error || `Diet plan generation failed: ${dietResponse.status}`);
        }

        const dietData = await dietResponse.json();
        console.log("Diet plan received:", dietData);

        // Update UI with diet plan
        if (dietPlanElement && dietData.diet_plan) {
          if (typeof dietData.diet_plan === 'string') {
            // Clean up and format the diet plan text
            dietPlanElement.innerHTML = dietData.diet_plan.replace(/\n/g, '<br>');
          } else if (Array.isArray(dietData.diet_plan) || typeof dietData.diet_plan === 'object') {
            dietPlanElement.innerHTML = JSON.stringify(dietData.diet_plan, null, 2);
          } else {
            throw new Error('Invalid diet plan data type received');
          }
          console.log("Diet plan displayed successfully");
        } else {
          throw new Error('Invalid diet plan data received');
        }
      } catch (error) {
        console.error('Diet plan generation failed:', error);
        if (dietPlanElement) {
          dietPlanElement.textContent = 'Failed to generate diet plan. Please try again.';
          console.log("Error message displayed");
        }
      } finally {
        // Re-enable button
        document.getElementById('gendietplan').disabled = false;
        console.log("Button re-enabled");
      }
    }

    // Call the function to create the weight chart
  </script>

</body>

</html>